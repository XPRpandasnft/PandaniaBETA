<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Panda Pawn Shop</title>

<style>
  body {
    margin: 0;
    font-family: 'Orbitron', Arial, sans-serif;
    background: #000;
    color: #f5e9ff;
    text-align: center;
    padding: 40px 20px;
  }

  h1 {
    font-size: 2em;
    margin-bottom: 20px;
    text-shadow: 0 0 8px #bb33ff, 0 0 16px #a020f0;
  }

  #connectWalletBtn {
    padding: 14px 28px;
    font-size: 1.1em;
    font-weight: bold;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background: linear-gradient(135deg, #bb33ff, #7a2bf8);
    color: white;
    box-shadow: 0 0 12px #bb33ff, 0 0 26px #a020f0, 0 0 48px #bb33ff;
    transition: all 0.3s ease;
    margin-bottom: 20px;
  }

  #connectWalletBtn:hover {
    background: linear-gradient(135deg, #d175ff, #bb33ff);
    transform: scale(1.05);
    box-shadow: 0 0 24px #bb33ff, 0 0 48px #a020f0;
  }

  #walletName {
    margin-bottom: 20px;
    font-weight: bold;
    font-size: 1.2em;
    color: #caffff;
  }

  #nftContainer {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 16px;
    margin-top: 20px;
  }

  .nftCard {
    width: 120px;
    height: 120px;
    border: 2px solid #bb33ff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 12px #bb33ff, 0 0 24px #a020f0;
    background: #111;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .nftCard img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }

  @keyframes neonPulse {
    0%,100% { box-shadow: 0 0 12px #bb33ff,0 0 24px #a020f0; }
    50% { box-shadow: 0 0 24px #d175ff,0 0 48px #bb33ff; }
  }
</style>
</head>
<body>

<h1>Panda Pawn Shop</h1>
<button id="connectWalletBtn">Connect Wallet</button>
<div id="walletName"></div>
<div id="nftContainer"></div>

<!-- Proton SDK -->
<script src="https://unpkg.com/@proton/web-sdk@latest"></script>

<script>
  const RPC_ENDPOINTS = [
    "https://proton.eosusa.io",
    "https://proton.greymass.com",
    "https://proton.pink.gg"
  ];
  const NFT_SCHEMA = "144534352512"; // Replace with your NFT schema
  let protonSession = null;
  let connectedWallet = null;

  async function fetchWithFallback(path, options) {
    for (let i = 0; i < RPC_ENDPOINTS.length; i++) {
      try {
        const response = await fetch(`${RPC_ENDPOINTS[i]}${path}`, options);
        if (response.ok) return await response.json();
      } catch(e) { console.warn(`Endpoint ${RPC_ENDPOINTS[i]} failed:`, e); }
    }
    return null;
  }

  async function connectWallet() {
    try {
      const { session, link } = await window.ProtonWebSDK({
        linkOptions: { endpoints: RPC_ENDPOINTS, restoreSession: false },
        selectorOptions: { appName: "Panda Pawn Shop" }
      });
      protonSession = session;
      connectedWallet = session.auth.actor;
      document.getElementById('walletName').textContent = connectedWallet;
      document.getElementById('connectWalletBtn').style.display = 'none';
      await loadNFTs(connectedWallet);
    } catch (err) {
      console.error('Wallet connection failed:', err);
      alert('Failed to connect wallet.');
    }
  }

  async function loadNFTs(wallet) {
    const data = await fetchWithFallback('/v1/chain/get_table_rows', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        json: true,
        code: 'atomicassets',
        scope: wallet,
        table: 'assets',
        limit: 100
      })
    });

    const container = document.getElementById('nftContainer');
    container.innerHTML = '';

    if (!data || !data.rows || data.rows.length === 0) {
      container.innerHTML = '<p>No NFTs found in this wallet.</p>';
      return;
    }

    const nftRows = data.rows.filter(nft => nft.schema_name === NFT_SCHEMA);
    if (nftRows.length === 0) {
      container.innerHTML = '<p>No matching NFTs found for this schema.</p>';
      return;
    }

    nftRows.forEach(nft => {
      const imgUrl = nft.data.img || nft.data.image || nft.data.url || '';
      const card = document.createElement('div');
      card.className = 'nftCard';
      if(imgUrl) {
        const img = document.createElement('img');
        img.src = imgUrl;
        card.appendChild(img);
      } else {
        card.textContent = 'No Image';
      }
      container.appendChild(card);
    });
  }

  document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);
</script>

</body>
</html>
